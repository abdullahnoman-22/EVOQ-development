<!-- sections/custom-product-banner.liquid -->
<div class="cpb-page-width cpb-custom-product-banner">
  <div class="cpb-banner-container">
    <!-- Header Section -->
    <div class="cpb-header-section">
      {% if section.settings.heading != blank %}
        <h2 class="cpb-main-heading">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <p class="cpb-subheading">{{ section.settings.subheading }}</p>
      {% endif %}
    </div>
    
    <!-- Products Grid -->
    <div class="cpb-products-grid">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'product_card' %}
            <div class="cpb-product-card" {{ block.shopify_attributes }}>
              {% if block.settings.product_link != blank %}
                <a href="{{ block.settings.product_link }}" class="cpb-product-link">
              {% endif %}
              
              <div class="cpb-product-image-wrapper">
                {% if block.settings.product_image != blank %}
                  <img src="{{ block.settings.product_image | img_url: '400x400' }}" 
                       alt="{{ block.settings.product_image.alt | default: block.settings.product_title }}"
                       class="cpb-product-image">
                {% else %}
                  <!-- Placeholder for missing image -->
                  <div class="cpb-product-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="cpb-placeholder-icon">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <span class="cpb-placeholder-text">Add Image</span>
                  </div>
                {% endif %}
                
                <div class="cpb-product-overlay">
                  {% if block.settings.product_title != blank %}
                    <h3 class="cpb-product-title">{{ block.settings.product_title }}</h3>
                  {% endif %}
                  
                  {% if block.settings.product_description != blank %}
                    <p class="cpb-product-description">{{ block.settings.product_description }}</p>
                  {% endif %}
                  
                  <div class="cpb-product-arrow">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" class="cpb-icon cpb-icon-arrow" viewBox="0 0 14 10">
                      <path fill="currentColor" fill-rule="evenodd" d="M8.537.808a.5.5 0 0 1 .817-.162l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 1 1-.708-.708L11.793 5.5H1a.5.5 0 0 1 0-1h10.793L8.646 1.354a.5.5 0 0 1-.109-.546" clip-rule="evenodd"></path>
                    </svg>
                  </div>
                </div>
              </div>
              
              {% if block.settings.product_link != blank %}
                </a>
              {% endif %}
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>
</div>

<style>
  .cpb-page-width {
    margin: 0 auto;
    padding: 40px 20px;
  }
  
  
  .cpb-banner-container {
    display: flex;
    flex-direction: column;
    gap: 32px;
  }
  
  /* Header Section */
  .cpb-header-section {
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .cpb-main-heading {
    font-size: 36px;
    font-weight: 600;
    color: #1a202c;
    margin-bottom: 12px;
    line-height: 44px;
    letter-spacing: -0.5px;
    font-family: 'Inter' !important;
  }
  
  .cpb-subheading {
    font-size: 20px;
    color: #666;
    line-height: 30px;
    font-weight: 400;
    margin: 0;
    font-family: 'Inter';
  }
  
  /* Products Grid */
  .cpb-products-grid {
    position: relative;
    display: flex;
    gap: 20px;
    align-items: stretch;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding: 0 20px;
  }
  
  .cpb-products-grid::-webkit-scrollbar {
    display: none;
  }
  
  .cpb-products-grid {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  
  /* Product Cards */
  .cpb-product-card {
    flex: 0 0 280px;
    border-radius: 5px;
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    height: 220px;
  }
  
  .cpb-product-link {
    display: contents;
    width: 100%;
    height: 100%;
    text-decoration: none;
    color: inherit;
    position: relative;
  }
  
  .cpb-product-image-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
  }
  
  .cpb-product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .cpb-product-card:hover .cpb-product-image {
    transform: scale(1.05);
  }
  
  /* Placeholder for missing images */
  .cpb-product-placeholder {
    width: 100%;
    height: 100%;
    background: #f7fafc;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #a0aec0;
    border: 2px dashed #e2e8f0;
  }
  
  .cpb-placeholder-icon {
    width: 48px;
    height: 48px;
    margin-bottom: 8px;
  }
  
  .cpb-placeholder-text {
    font-size: 20px;
    font-weight: 500;
  }
  
  .cpb-product-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2;
    padding: 24px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background: linear-gradient(135deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.05) 100%);
  }
  
  .cpb-product-title {
    font-size: 20px;
    font-weight: 500;
    color: #2d3748;
    margin: 0 0 8px 0;
    font-family: "Shopify Sans Web" !important;
  }
  
  .cpb-product-description {
    font-size: 14px;
    color: #4a5568;
    margin: 0;
    line-height: 1.4;
    opacity: 0.9;
  }
  
  .cpb-product-arrow {
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.95);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    align-self: flex-start;
    margin-top: auto;
  }
  
  .cpb-product-arrow:hover {
    background: rgba(255,255,255,1);
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0,0,0,0.15);
  }
  
  .cpb-product-arrow svg {
    width: 20px;
    height: 20px;
    color: #2d3748;
  }
  
  /* Responsive Design */
  @media (max-width: 1024px) {
    .cpb-product-card {
      flex: 0 0 250px;
      height: 280px;
    }
  }
  
  @media (max-width: 768px) {
    .cpb-page-width {
      padding: 30px 15px;
    }
    
    .cpb-main-heading {
      font-size: 28px;
    }
    
    .cpb-products-grid {
      gap: 15px;
    }
    
    .cpb-product-card {
      flex: 0 0 220px;
      height: 240px;
    }
  }
  
  @media (max-width: 480px) {
    .cpb-main-heading {
      font-size: 24px;
    }
    
    .cpb-subheading {
      font-size: 14px;
    }
    
    .cpb-product-card {
      flex: 0 0 200px;
      height: 220px;
    }
    
    .cpb-product-title {
      font-size: 16px;
    }
    
    .cpb-product-description {
      font-size: 12px;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const cpbProductsGrid = document.querySelector('.cpb-products-grid');
  
  if (cpbProductsGrid) {
    let autoScrollInterval;
    let isUserInteracting = false;
    
    // Calculate scroll amount based on card width + gap
    function getScrollAmount() {
      const firstCard = cpbProductsGrid.querySelector('.cpb-product-card');
      if (!firstCard) return 0;
      
      const cardWidth = firstCard.offsetWidth;
      const gap = 20; // Default gap
      return cardWidth + gap;
    }
    
    // Auto scroll function
    function startAutoScroll() {
      autoScrollInterval = setInterval(() => {
        if (!isUserInteracting && cpbProductsGrid.children.length > 0) {
          const scrollAmount = getScrollAmount();
          const maxScroll = cpbProductsGrid.scrollWidth - cpbProductsGrid.clientWidth;
          
          if (cpbProductsGrid.scrollLeft >= maxScroll) {
            // Reset to beginning
            cpbProductsGrid.scrollTo({
              left: 0,
              behavior: 'smooth'
            });
          } else {
            // Scroll to next product
            cpbProductsGrid.scrollBy({
              left: scrollAmount,
              behavior: 'smooth'
            });
          }
        }
      }, 3000); // Scroll every 3 seconds
    }
    
    // Stop auto scroll
    function stopAutoScroll() {
      if (autoScrollInterval) {
        clearInterval(autoScrollInterval);
      }
    }
    
    // Only start auto scroll if there are products to scroll
    if (cpbProductsGrid.children.length > 1) {
      startAutoScroll();
    }
    
    // Pause on hover
    cpbProductsGrid.addEventListener('mouseenter', function() {
      isUserInteracting = true;
    });
    
    cpbProductsGrid.addEventListener('mouseleave', function() {
      isUserInteracting = false;
    });
    
    // Pause on touch
    cpbProductsGrid.addEventListener('touchstart', function() {
      isUserInteracting = true;
    });
    
    cpbProductsGrid.addEventListener('touchend', function() {
      setTimeout(() => {
        isUserInteracting = false;
      }, 2000); // Resume after 2 seconds
    });
    
    // Pause on manual scroll
    cpbProductsGrid.addEventListener('scroll', function() {
      isUserInteracting = true;
      
      // Resume after user stops scrolling
      clearTimeout(cpbProductsGrid.scrollTimeout);
      cpbProductsGrid.scrollTimeout = setTimeout(() => {
        isUserInteracting = false;
      }, 3000);
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
      stopAutoScroll();
      setTimeout(() => {
        if (cpbProductsGrid.children.length > 1) {
          startAutoScroll();
        }
      }, 500);
    });
  }
});
</script>

{% schema %}
{
  "name": "Custom Product Banner",
  "settings": [
    {
      "type": "header",
      "content": "Heading Section"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Main Heading",
      "default": "Related Products"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Real creations, real results. Discover delicious, collagen-powered recipes shared by our amazing community â€” made with love and glow."
    }
  ],
  "blocks": [
    {
      "type": "product_card",
      "name": "Product Card",
      "settings": [
        {
          "type": "text",
          "id": "product_title",
          "label": "Product Title",
          "default": "Product Name"
        },
        {
          "type": "textarea",
          "id": "product_description",
          "label": "Product Description",
          "info": "Optional short description to display on the card"
        },
        {
          "type": "image_picker",
          "id": "product_image",
          "label": "Product Image"
        },
        {
          "type": "url",
          "id": "product_link",
          "label": "Product Link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Product Banner",
      "blocks": [
        {
          "type": "product_card",
          "settings": {
            "product_title": "Blueberry"
          }
        },
        {
          "type": "product_card",
          "settings": {
            "product_title": "Vanilla"
          }
        },
        {
          "type": "product_card",
          "settings": {
            "product_title": "Chocolate"
          }
        },
        {
          "type": "product_card",
          "settings": {
            "product_title": "Strawberry"
          }
        }
      ]
    }
  ]
}
{% endschema %}